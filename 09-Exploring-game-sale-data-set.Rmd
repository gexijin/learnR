# The game sales dataset

Welcome to the fascinating spectacle of video game sales data, which was heroically downloaded from Kaggle: 
[https://www.kaggle.com/rush4ratio/video-game-sales-with-ratings#Video_Games_Sales_as_at_22_Dec_2016.csv](https://www.kaggle.com/rush4ratio/video-game-sales-with-ratings#Video_Games_Sales_as_at_22_Dec_2016.csv). We will witness the performance of the sales across North America, Europe, Japan, and other regions, which all add up to the global sales. Our dataset is also enchanted with the critic scores, user scores, and the number of brave souls who dared to contribute to these scores. 

Here's a brief overview of the dataset's contents:

Name: Name of the game.

Platform: Console on which the game is running.

Year_of_Release: Year of the game released.

Genre: The category of the game.

Publisher: The game's champion and distributor.

NA_Sales: Game sales in North America (in millions of units).

EU_Sales: Game sales in the European Union (in millions of units).

JP_Sales: Game sales in Japan (in millions of units).

Other_Sales: Game sales in the rest of the world, i.e. Africa, Asia excluding Japan, Australia, Europe excluding the E.U. and South America (in millions of units).

Global_Sales: Total sales in the world (in millions of units).

Critic_Score: Aggregate score compiled by Meta critic staff.

Critic_Count: The number of critics who've lent their voices to the Critic Score.

User_Score: Score by Metacritic's subscribers.

User_Count: The number of users who weighed in with their opinions.

Developer: Party responsible for creating the game.

Rating: The ESRB ratings: 
E for "Everyone"; E10+ for "Everyone 10+"; T for "Teen"; M for "Mature"; AO for "Adults Only"; RP for "Rating Pending"; and the nostalgic K-A for "kids to adults".

After downloading the data, we transmuted N/A into NA first using Excel and saved it as a .csv file, then read it into R. We banished observations with empty strings of Rating, leaving us with 6825 observations in our "game" dataset. We observed a curious phenomenon: an abundance of sales values dared to be zero. We then transformed the sales into basic units and plus 1 to prepare for the logarithmic transformation (a wizard's trick to normalize distributions). We also scaled the Critic Scores down by a factor of 10 to harmonize with the User Scores' scale.

## Reading in data and managing the dataset
```{r message=FALSE, warning=FALSE}
# Load the dataset
tem <- read.csv("datasets/video-game-sales-at-22-Dec-2016.csv")
tem <- na.omit(tem)  # Remove NA

# Keep games with ratings and remove redundant levels
library(dplyr)
game <- tem %>% filter(Rating != "") %>% droplevels() 

# Convert sales to actual figures by multiplying 1000000 
# Plus one to avoid the curse of negative log (sneaky!)
game$Year_of_Release <- as.factor(as.character(game$Year_of_Release))
game$NA_Sales <- game$NA_Sales * 1000000 + 1
game$EU_Sales <- game$EU_Sales * 1000000 + 1
game$JP_Sales <- game$JP_Sales * 1000000 + 1
game$Other_Sales <- game$Other_Sales * 1000000 + 1
game$Global_Sales <- game$Global_Sales * 1000000 + 1

# Harmonizing Critic Scores to match the User Score scale by dividing by 10
game$Critic_Score <- as.numeric(as.character(game$Critic_Score)) / 10  
game$User_Score <- as.numeric(as.character(game$User_Score))
game$Critic_Count <- as.numeric(game$Critic_Count)
game$User_Count <- as.numeric(game$User_Count)

# Set category variables as factor variables 
game$Name <- as.factor(game$Name)
game$Platform <- as.factor(game$Platform)
game$Genre <- as.factor(game$Genre)
game$Publisher <- as.factor(game$Publisher)
game$Developer <- as.factor(game$Developer)
game$Rating <- as.factor(game$Rating)

# Format column names for clarity
colnames(game) <- c("Name", "Platform", "Year.Release", "Genre", "Publisher", "NA.Sales", "EU.Sales", "JP.Sales", "Other.Sales", "Global.Sales", "Critic.Score", "Critic.Count", "User.Score", "User.Count", "Developer", "Rating")

# Display the structure and a summary of the dataset
str(game)
summary(game)
```

The summary reveals the existence of games published under the same banner (or name) but across various platforms; PlayStation 2(PS2) is the Goliath among platform; Action claims the throne as the genre of choice; Electronic Arts boasts the highest frequency among publishers; Rating T and E lead the rating pack; The sales data display small minimums, quantiles, and medians but boast heroic maximums, indicating the presence of superstar games; Exceedingly big maximum User Count hints at a cult-like following for certain titles. 

Our pre-analysis shows that these variables are shy away from normality, notably the sales and score counts. To remedy this, we shall wield the power of logarithms!
```{r}
NA.Sales.Log <- log(game$NA.Sales)   
EU.Sales.Log <- log(game$EU.Sales)  
JP.Sales.Log <- log(game$JP.Sales)   
Other.Sales.Log <- log(game$Other.Sales)  
Global.Sales.Log <- log(game$Global.Sales) 
Critic.Count.Log <- log(game$Critic.Count)
User.Count.Log <- log(game$User.Count)
```

Now let's bind the log-transformed variables with their original counterparts.
```{r}
game.log <- cbind.data.frame(NA.Sales.Log, EU.Sales.Log, JP.Sales.Log, Other.Sales.Log,
Global.Sales.Log, Critic.Count.Log, User.Count.Log)
game <- cbind.data.frame(game, game.log)  # The data we use for analysis
```

Time to conjure histograms and QQ plots for our transformed dataset.
```{r message=FALSE, fig.width=8, fig.height=10}
# Select numeric columns for visualization
name <- colnames(game)[c(11, 13, 17:23)] 
par(mfrow = c(5, 4))  # Layout in 5 rows and 4 columns

# Loop through each numeric variable and create a histogram and a Q-Q plot
for (i in 1:length(name)){
  sub <- sample(game[name[i]][, 1], 5000)
  submean <- mean(sub)
  hist(sub, main = paste("Hist. of", name[i], sep = " "), xlab = name[i])
  abline(v = submean, col = "blue", lwd = 1)
  qqnorm(sub, main = paste("Q-Q Plot of", name[i], sep = " "))
  qqline(sub) 
  if (i == 1) {s.t <- shapiro.test(sub)
  } else {s.t <- rbind(s.t, shapiro.test(sub))
 }
}
# Extract the essence of the Shapiro-Wilk test results
s.t <- s.t[, 1:2]  # Take first two columns of shapiro.test result
s.t <- cbind(name, s.t) # Add variable name for the result
s.t
```
The histograms and QQ plots of these original sales are not abnormally distributed, but the log-transformed sales data now resemble much clearer and close to normal distributions, especially the log value of global sales. Even though the Shapiro test, with a p-value less than 0.05, seems to dispel the illusion of normality, it's nearly a portrait of normality. Perhaps the absentee values are the reason for the abnormality of the raw sales data. Our analytic crystal ball will gaze more intently upon the log of global sales.

The histograms and QQ plots also suggest that the two scores and log-transformed counts are doing a tantalizing tango with normal distribution. Despite the Shapiro-Wilk test's naysaying, we'll proceed under the assumption that they are normally distributed for our analysis.

In this realm of data, there lie intriguing enigmas: the distribution dance of global versus regional sales; the web of relationships between them; the mystical connection between critic and user scores along with their respective counts; and whether these scores and counts cast the most potent spells on sales, or if other arcane elements such as genre, rating, platform, and publisher have a part to play in this grand sales ritual.

Now let's wave our wands for some visual magic!

## Visualization of categorical variables

To simplify platform analysis, we regroup platform into a new variable called Platform.type.
```{r}
# Regroup platform into Platform.type categories
pc <- c("PC")
xbox <- c("X360", "XB", "XOne")
nintendo <- c("Wii", "WiiU", "N64", "GC", "NES", "3DS", "DS") 
playstation <- c("PS", "PS2", "PS3", "PS4", "PSP", "PSV")
game <- game %>%
  mutate(Platform.type = ifelse(Platform %in% pc, "PC",
                           ifelse(Platform %in% xbox, "Xbox",
                             ifelse(Platform %in% nintendo, "Nintendo", 
                               ifelse(Platform %in% playstation, "Playstation", "Others"))))) 
```


(ref:game-PlatformType1) Bar plot of platform type.

```{r game-PlatformType1, fig.cap='(ref:game-PlatformType1)', fig.align='center'}
library(ggplot2)
ggplot(game, aes(x = Platform.type)) + geom_bar(fill = "blue")
```

The bar plot regales us with a tale of platform dominance: Playstation leads the charge, followed by Xbox and Nintendo, with the "Others" trailing behind.

The realm of genres is a diverse landscape, but let's see who really rules the land.
```{r}
dat <- data.frame(table(game$Genre))
dat$fraction <- dat$Freq / sum(dat$Freq)
dat <- dat[order(dat$fraction), ]
dat$ymax <- cumsum(dat$fraction)
dat$ymin <- c(0, head(dat$ymax, n = -1))
names(dat)[1] <- "Genre"
library(ggplot2)
ggplot(dat, aes(fill = Genre, ymax = ymax, ymin = ymin, xmax = 4, xmin = 3)) +
  geom_rect(colour = "grey30") +  # Background color
  coord_polar(theta = "y") +  # Coordinate system to polar
  xlim(c(0, 4)) +  
  labs(title = "Ring plot for Genre", fill = "Genre") +
  theme(plot.title = element_text(hjust = 0.5))
```

The Genre ring plot crowns Action, Sports, and Shooter as the mightiest triumvirate, with Action occupies nearly a quarter of genre kingdom. Combined, these three genres account for more than half the realm. Puzzle, Adventure, and Stratege have relatively less count.

Now let's consolidate the rare ratings AO, RP, and K-A under "Others" due to their sparse data points.
```{r}
# Consolidate Ratings into Rating.type 
rating <- c("E", "T", "M", "E10+")
game <- game %>% 
  mutate(Rating.type = ifelse(Rating %in% rating, as.character(Rating), "Others")) 
```

Let's slice up the ratings pie chart of gamers' preferred flavors.
```{r}
counts <- sort(table(game$Rating.type), decreasing = TRUE)
# Rename the names of counts for detail information
names(counts) <- c("T - Teen", "E - Everyone", "M - Mature", "E10+ - Everyone 10+", "Others")
pct <- paste(round(counts/sum(counts) * 100), "%", sep = " ")
lbls <- paste(names(counts), "\n", pct, sep = " ")  # Rating information and percentage
pie(counts, labels = lbls, col = rainbow(length(lbls)),
  main="Pie Chart of Ratings with sample sizes")
```

The pie chart reveals that the popular ratings are T, E, M, and E10+, according to the order. While "Others" claims but a sliver of the pie.

(ref:game-mosaic) Mosaic plot between platform type and rating type.

```{r game-mosaic, warning=FALSE, message=FALSE, fig.cap='(ref:game-mosaic)', fig.align='center'}
library(ggmosaic)
library(plotly)
p <- ggplot(game) +
  geom_mosaic(aes(x = product(Rating.type), fill = Platform.type), na.rm = TRUE) +
  labs(x = "Rating Type", y = "Platform Type", title="Mosaic Plot") +
  theme(axis.text.y = element_blank())
ggplotly(p)
```

Same as we noticed previously, the mosaic plot reiterates that 'Others' is barely visible due to its minuscule size. For all platform and rating combinations, Playstation dominates the platform ratings for all other three different rating types except for Everyone 10 plus. Nintendo captures the heart of the "Everyone 10+" category. It's the second most popular platform for rating Everyone. Xbox holds steady as the runner-up in Mature and Teenage categories, and holds the third favorite platform for rating Everyone and Everyone 10 plus. In the category of 'Others', games rated 'Everyone' are the chosen ones.

>
```{exercise}

>
Download the game sales dataset and clean the data as previously outlined at the beginning of this chapter. Then, produce a mosaic plot between genre and rating. Briefly interpret your mystical creation.
```

## Correlation among numeric variables

(ref:game-corrplot) Corrplot among numeric variables.

```{r game-corrplot, warning=FALSE, message=FALSE,fig.width=8, fig.height=8, fig.cap='(ref:game-corrplot)', fig.align='center'}
st <- game[, c(11, 13, 17:23)] # Select the numeric variables of interest
st <- na.omit(st)
library(ellipse)  
library(corrplot)
corMatrix <- cor(as.matrix(st))  # Correlation matrix
col <- colorRampPalette(c("#7F0000", "red", "#FF7F00", "yellow", "#7FFF7F",
                           "cyan", "#007FFF", "blue", "#00007F"))
corrplot.mixed(corMatrix, order = "AOE", lower = "number", lower.col = "black", 
               number.cex = .8, upper = "ellipse",  upper.col = col(10), 
               diag = "u", tl.pos = "lt", tl.col = "black")
```

With high r-values of 0.75, 0.65, 0.52, and 0.42 between the log-transformed values of Global.Sales and regional sales, We'll earmark Global.Sales.Log as our target for later romance with other variables. Also, regional sales are positively flirting with one another. User Score is sweet to Critic Score with an r of 0.58. The correlation between User Count log and User Score stays relatively low. 

(ref:game-dendrogram) Exercise dendrogram for numeric variables.

```{r game-dendrogram, fig.cap='(ref:game-dendrogram)', fig.align='center'}
plot(hclust(as.dist(1 - cor(as.matrix(st)))))  # Hierarchical clustering
```

In this dendrogram, all log values of sales except JP.Sales.Log build one cluster like best friends; Scores, log values of counts, along with JP.Sales form their own clique. In the first cluster, Other.Sales.Log is whispering closest to Global.Sales.Log, followed by NA.Sales.Log, with EU.Sales.Log joining the fray.

## Analysis of score and count

(ref:game-score) Scatter and density plot for critic score and user score.

```{r game-score, message=FALSE, warning=FALSE, fig.width=10, fig.height=3, fig.cap='(ref:game-score)', fig.align='center'}
library(ggpmisc)  # Package for function stat_poly_eq(), adding equations to plots
formula <- y ~ x

# A scatter plot that reveals the hidden dance between User Score and Critic Score
p1 <- ggplot(game, aes(x = User.Score, y = Critic.Score)) + 
  geom_point(aes(color = Platform), alpha = .8) + 
  geom_smooth(method = 'lm', se = FALSE, formula = formula) +  # Add regression line
  theme(legend.position = "none") +
  stat_poly_eq(formula = formula,   # Add regression equation and R square value
               eq.with.lhs = "italic(hat(y))~`=`~",  # Add ^ on y
               aes(label = paste(..eq.label.., ..rr.label.., sep = "*plain(\",\")~")),
               label.x.npc = "left", label.y.npc = 0.9,   # Position of the equation label
               parse = TRUE)  # Output.type as "expression" 

# Density plot - where scores show off their curves
p2 <- ggplot() + 
  geom_density(data = game, aes(x = Critic.Score), color = "darkblue", fill = "lightblue") + 
  geom_density(data = game, aes(x = User.Score), color = "darkgreen", fill = "lightgreen",                                       alpha=.5) +
  labs(x = "Critic.Score-blue, User.Score-green") 

# Combine the plots for a double feature
library(gridExtra)
grid.arrange(p1, p2, nrow = 1, ncol = 2)
```

A positive correlation waltzes between Critic.Score and User.Score. It seems the critics are a tough crowd, scoring on average lower than users.

```{r}
t.test(game$Critic.Score, game$User.Score)
```

T-test with a p-value of much less than 0.05 suggests to accept the alternative hypothesis with 95% confidence: the difference between critic and user scores is not by mere chance. The mean critic score prances at 7.03, while the mean user score frolics slightly higher at 7.19.

(ref:game-count1) Binhex plot for critic count and user count.

```{r game-count1, warning=FALSE, fig.cap='(ref:game-count1)', fig.align='center'}
library(hexbin) # For hexagonal wizardry

# Binhex plot for Critic Count Log
p1 <- ggplot(game, aes(x = Critic.Count.Log, y = Critic.Score)) +
  stat_binhex() + # Bin 2d plane into hexagons
  scale_fill_gradientn(colours = c("black", "red"),
                       name = "Frequency") # Adding a custom continuous color palette

# Binhex plot for User Count Log
p2 <- ggplot(game, aes(x = User.Count.Log, y = User.Score)) +
  stat_binhex() +
  scale_fill_gradientn(colours = c("black", "red"), 
                       name = "Frequency") # Color legend

# Show both hexes side by side
grid.arrange(p1, p2, nrow = 1, ncol = 2)
```

Critic.Score and Critic.Count.Log share a decent correlation, with an r-value of 0.41 noted earlier, though Critic.Count.Log doesn’t have an overall impact on Critic.Score. On the other canvas, User.Score appears to maintain its independence from User.Count.Log.

>
```{exercise}

>
Use ggplot2 package to conjure up a scatter plot with a smooth line between Global_Sales and NA_Sales. In plain, mortal language, explain what you find in the plot.
```


>
```{exercise}

>
Employ a density plot to illustrate the relationship among Global_Sales, NA_Sales, EU_Sales, JP_Sales, and Other_Sales. Interpret your plot.
```

## Analysis of sales
With an eclectic collection of plots and analysis, we delve into the intricacies of sales through the prisms of year of release, region, rating, genre, and more.

###  By Year.Release

(ref:game-SalesYear1) Total global sales and games released by year.

```{r game-SalesYear1, message=FALSE, warning=FALSE, fig.width=8, fig.height=4, fig.cap='(ref:game-SalesYear1)', fig.align='center'}
# Prepare the data
Year.Release <- game$Year.Release 
counts <- data.frame(table(Year.Release))
p <- game %>%
  select(Year.Release, Global.Sales) %>%
  group_by(Year.Release) %>%
  summarise(Total.Sales = sum(Global.Sales))
q <- cbind.data.frame(p, counts[2])  # Add counts to data frame
names(q)[3] <- "count"
q$count <- as.numeric(q$count)

# Plot the data
ggplot(q, aes(x = Year.Release, y = Total.Sales, label = q$count)) +
  geom_col(fill = "green") +
  geom_point(y = q$count * 500000, size = 3, shape = 21, fill = "Yellow" ) +
  geom_text(y = (q$count + 50) * 500000) +  # Position of the text: count of games each year
  theme(axis.text.x = element_text(angle = 90),
        panel.background = element_rect(fill = "purple"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  scale_x_discrete("Year of Release", labels = as.character(Year.Release), breaks = Year.Release) 
```

The histogram of total sales illustrates that before 1996, game sales were akin to a lonely desert, only one game was released for each year. Between 1996 and 2000, like a slow-blooming flower, sales and game releases gradually climbed. After that, we witnessed a gold rush in sales and game releases, peaking in 2008. Following this golden year, both total sales and count of games went downhill.

###  By Region

(ref:game-SalesRegion1) Year wise log global sales by region.

```{r game-SalesRegion1, warning=FALSE, message=FALSE,fig.width=9, fig.height=4, fig.cap='(ref:game-SalesRegion1)', fig.align='center'}
library(reshape2)
game %>%
  select(Year.Release, NA.Sales.Log, EU.Sales.Log, JP.Sales.Log, 
         Other.Sales.Log, Global.Sales.Log) %>%
  melt(id.vars = "Year.Release") %>%   # Stacks other columns into "Year.Release"
  group_by(Year.Release, variable) %>% 
  summarise(total.sales = sum(value)) %>%
  ggplot(aes(x = Year.Release, y = total.sales, color = variable, group = variable)) +
    geom_point() + 
    geom_line() + 
    labs(x = "Year Release", y = "Total Sales Log Value", color = "Region") +
    theme(axis.text.x = element_text(angle = 90),
          panel.background = element_rect(fill="pink"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank())
```

The trajectories of log sales in North America, Europe, and Other regions seem to be singing in harmony, while Japan performs its own unique symphony, reaffirming the conclusions drawn from our earlier cluster analysis.

###  By Rating

(ref:game-SalesRating1) Sales by rating type.

```{r game-SalesRating1, fig.cap='(ref:game-SalesRating1)', fig.align='center'}
game$Rating.type <- as.factor(game$Rating.type)
x <- game[, c(6:10)] # Sales across different regions
matplot(t(x), type = "l", col = rainbow(5)[game$Rating.type])
legend("center", levels(game$Rating.type), fill = rainbow(5), cex = 0.8, pt.cex = 1)
text(c(1.2, 2, 3, 3.9, 4.8), 80000000, colnames(x))
```

The line graph regales us with the tale of an "E for Everyone" title, predominantly purchased in North America and Europe, soaring to the lofty heights of 80 million in global sales—with North America accounting for half. A quick perusal of the data reveals the star of the show to be "Wii Sports" from 2006. Additionally, Mature games are popular in North America(green), Everyone games(red) have good sales in Europe, while Japan holds a torch for Teen(purple) and Everyone(red) games. The "Other" region samples a medley of ratings, not playing favorites.

###  By Genre

(ref:game-SalesGenre1) Year wise log global sales by Genre.

```{r game-SalesGenre1, message=FALSE,fig.cap='(ref:game-SalesGenre1)', fig.align='center'}
game %>% 
  select(Year.Release, Global.Sales.Log, Genre) %>%
  group_by(Year.Release, Genre) %>%
  summarise(Total.Sales.Log = sum(Global.Sales.Log)) %>%
  ggplot(aes(x = Year.Release, y = Total.Sales.Log, group = Genre, fill = Genre)) +
         geom_area() +
         theme(legend.position = "right", axis.text.x = element_text(angle = 90),
               panel.background = element_rect(fill = "blue"),
               panel.grid.major = element_blank(),
               panel.grid.minor=element_blank()) 
```

Behold the tapestry of sales across genres, with 2007-2009 as the golden era—years when the sales towered above 7000 (log value) annually. Action and sports genres have reigned supreme over the two-decade span, while adventure, puzzle, and strategy genres remained relatively niche.

### by Score 

(ref:game-SalesScore) Global sales in relation to critic and user scores.

```{r game-SalesScore, warning=FALSE, message=FALSE, fig.width=12, fig.height=4, fig.cap='(ref:game-SalesScore)', fig.align='center'}
p1 <- ggplot(game, aes(x = Critic.Score, y = Global.Sales.Log)) + 
  geom_point(aes(color = Genre)) + 
  geom_smooth()  # Add a regression line
p2 <- ggplot(game, aes(x = User.Score, y = Global.Sales.Log)) + 
  geom_point(aes(color = Rating)) + 
  geom_smooth()
grid.arrange(p1, p2, nrow = 1, ncol = 2)
```

Regardless of Genre and Rating, a positive trend is noticeable between the Critic Score and the logarithm of Global Sales. Especially, when the Critic Score surpasses 9, Global Sales logarithm escalates sharply. In contrast, the logarithm of Global Sales increases at a snail's pace in response to User Scores.

```{r warning=FALSE}
# Abbreviate a particularly lengthy game title
game$Name <- gsub("Brain Age: Train Your Brain in Minutes a Day",
                  "Brain Age: Train Your Brain", game$Name)

# Analyze and plot the top 20 games by total sales
p1 <- game %>% 
  select(Name, User.Score, Critic.Score, Global.Sales) %>%
  group_by(Name) %>%
  summarise(Total.Sales = sum(Global.Sales), Avg.User.Score = mean(User.Score), 
            Avg.Critic.Score = mean(Critic.Score)) %>%
  arrange(desc(Total.Sales)) %>%
  head(20)

# Create a bar chart with accompanying score lines
ggplot(p1, aes(x = factor(Name, levels = Name))) +
  geom_bar(aes(y = Total.Sales/10000000), stat = "identity", fill = "green") +
  geom_line(aes(y = Avg.User.Score, group = 1, colour = "Avg.User.Score"), size = 1.5) +
  geom_point( aes(y = Avg.User.Score), size = 3, shape = 21, fill = "Yellow" ) +
  geom_line(aes(y = Avg.Critic.Score,  group = 1, colour = "Avg.Critic.Score"), size = 1.5) +
  geom_point(aes(y = Avg.Critic.Score), size = 3, shape = 21, fill = "white") + 
  theme(axis.text.x = element_text(angle = 90, size = 8)) +
  labs(title = "Top Global Sales Games with Scores", x = "Top-selling games" ) +  
  theme(plot.title = element_text(hjust = 0.5)) 
```

Among these 20 top-selling games, the first two games, 'Wii Sports' and 'Grand Theft Auto V' tower over their competitors in sales. For a majority of games, the average critic scores are higher than the average user scores, echoing the findings of our density plot in Figure \@ref(fig:game-score). "Call of Duty" titles, however, seem to be in the users' bad books, fetching notably lower average user scores compared to other top-selling games.

###  By Rating & Genre & Critic score

(ref:game-Sales1) Total sales for genre and rating in accordance with critic score.

```{r game-Sales1, message=FALSE,fig.width=12, fig.height=8, fig.cap='(ref:game-Sales1)', fig.align='center'}
# Aggregate and summarize data for plotting
p1 <- game %>%
  select(Rating.type, Global.Sales, Genre, Critic.Score) %>%
  group_by(Rating.type, Genre) %>%
  summarise(Total.Sales = sum(Global.Sales) / 10^8, Avg.Score = mean(Critic.Score)) 
p2 <- p1 %>% 
  group_by(Genre) %>% 
  summarise(Avg.Critic.Score = mean(Avg.Score))

# Create a bar chart with overlaid score lines
ggplot() + 
  geom_bar(data = p1, aes(x = Genre, y = Total.Sales, fill = Rating.type), 
           stat = "Identity", position = "dodge") +
  geom_line(data = p2, 
            aes(x = Genre, y = Avg.Critic.Score, group = 1, color = "Avg.Critic.Score"), 
            size = 2) +
  geom_point(data = p2, aes(x = Genre, y = Avg.Critic.Score, shape = "Avg.Critic.Score"),
             size = 3, color = "Blue") +
  scale_colour_manual("Score", breaks = "Avg.Critic.Score", values = "yellow") + 
  scale_shape_manual("Score", values = 19) +   # Add scale for line and point plot
  theme(axis.text.x = element_text(angle = 90), 
        legend.position = "bottom",
        panel.background = element_rect(fill = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) 
```

Everyone*sports games are so popular, knocking it out of the sales park, with the critics' nod of approval. Not to be outdone, 'Mature' rated Action and Shooter games follow closely, with a respectable critic score to match. An overlay of average critic scores on the bar chart reveals that Action and Role-Playing games lead the critic scores, while Fighting, adventure, and racing games get relatively lower average critic scores. However, higher critic scores do not always translate to higher sales; for example, Role-Playing games have higher critic scores but do not outsell Action games. Puzzle and strategy do sell less compared with other genres, though their critic scores are above the average.

###  By Platform

(ref:game-SalesPlatform1) Yearly market share by platform type.

```{r game-SalesPlatform1, message=FALSE, warning=FALSE, fig.cap='(ref:game-SalesPlatform1)', fig.align='center'}
library(viridis)
library(scales)
p <- game %>%
  group_by(Platform.type, Year.Release) %>%
  summarise(total = sum(Global.Sales))
p$Year.Release. <- as.numeric(as.character(p$Year.Release))
ggplot(p, aes(x = Year.Release., fill = Platform.type)) +
  geom_density(position = "fill") +
  labs(y = "Market Share") +
  scale_fill_viridis(discrete = TRUE) +
  scale_y_continuous(labels = percent_format()) 
```

It was a lonely landscape for PC and PlayStation before 1990, with PC reigning unchallenged in the gaming kingdom. As the clock ticked past 1995, newcomers Nintendo and Xbox burst onto the scene, hungrily carving out hefty slices of the market pie. Other platforms popped up like mushrooms in the early '90s, only to vanish into the annals of gaming history after a brief 20-year cameo. Fast forward to 2010, and it's a four-way dance-off with Nintendo, PC, PlayStation, and Xbox maintaining a harmonious market share equilibrium.

```{r}
# Compute 1-way ANOVA test for log value of global sales by Platform Type
model <- aov(Global.Sales.Log ~ Platform.type, data = game)
summary(model)
tukey <- TukeyHSD(model)
par(mar = c(4, 10, 2, 1))
plot(tukey, las = 1)
```

The ANOVA test confirms significant sales differences among platform types. Delving deeper, The Tukey post-hoc dance shows everyone stepping on its own toes, indicating notable differences across the board—except for Xbox versus Nintendo, and others versus Nintendo, who seem to be in step with one another, sharing a similar sales rhythm.

(ref:game-PlatformRating) Global sales log by platform and rating type.

```{r game-PlatformRating, fig.width=10, fig.height=4, fig.cap='(ref:game-PlatformRating)', fig.align='center'}
game$Platform.type <- as.factor(game$Platform.type)
ggplot(game, aes(x = Platform.type, y = Global.Sales.Log, fill = Rating.type)) +
  geom_boxplot() 
```

In the global sales log arena, PCs tend to play the underdog. In contrast, PlayStation and Xbox punch above their weight, landing higher median sales across various rating categories. Titles rated 'Everyone' seem to be crowd-pleasers on all platforms, while the 'Mature' category particularly flourishes on PC, PlayStation, and Xbox.

(ref:game-PlatformScore) Global sales log correlated with critic score across different platforms and genres.

```{r game-PlatformScore, fig.width=10, fig.height=6, fig.cap='(ref:game-PlatformScore)', fig.align='center'}
ggplot(game, aes(Critic.Score, Global.Sales.Log, color = Platform.type)) + 
  geom_point() + 
  facet_wrap(~ Genre)
```

Most genre plots in Figure \@ref(fig:game-PlatformScore) illustrate a universal truth: there is a positive correlation between Global.Sales.Log and Critic Score, the higher the critic score, the better the global sales log value. Most puzzle games were from Nintendo, while lots of stratege games are PC. For other genres, all platforms are distributed relatively evenly. PC sat in the corner of lower market share in different genres, while Nintendo's sporty, racing, platform, and misc games, Playstation's action, fighting, and racing games, Xbox's misc, action, and shooter games shined with knockout global sales logs.

##  Effect of platform type on principle components

To examine the influence of various gaming platforms on the variance in game sales, a principal component analysis (PCA) was conducted. When performing a PCA, it's essential to scale the data, especially if the variables are measured on different scales. 
```{r}
st <- game[, c(11, 13, 17:23)]
pca <- prcomp(st, scale = T)  # Normalization activated with scale = TRUE
percentVar <- round(100 * summary(pca)$importance[2, 1:9], 0)  # Compute % variances
```

(ref:game-pca) PCA plot colored by platform type.

```{r game-pca, fig.cap='(ref:game-pca)', fig.align='center'}
pcaData <- as.data.frame(pca$x[, 1:2]) # Extract 1st and 2nd PC values
pcaData <- cbind(pcaData, game$Platform.type)  # Add platform type for clustering
colnames(pcaData) <- c("PC1", "PC2", "Platform")
ggplot(pcaData, aes(PC1, PC2, color = Platform, shape = Platform)) +  
  geom_point(size = 0.8) +
  xlab(paste0("PC1: ", percentVar[1], "% variance")) +  # x-axis label
  ylab(paste0("PC2: ", percentVar[2], "% variance")) +  # y-axis label
  theme(aspect.ratio = 1)  # Width and height ratio
```

Each platform—PC, Xbox, Playstation, and Nintendo—claims its territory on the PCA chart, demonstrating a unique role in the variance components of PC1 and PC2, showcasing its distinct influence on the gaming market's variability.

(ref:game-Kmeans) K-means clustering on PCA components using ggfortify.

```{r warning=FALSE, game-Kmeans, fig.cap='(ref:game-Kmeans)', fig.align='center'}
library(ggfortify)
set.seed(1)
autoplot(kmeans(st, 3), data = st, label = FALSE, label.size = 0.1)
```

Linking this with the PCA Figure \@ref(fig:game-pca), we discover the 4 main actors: Playstation, Xbox, Nintendo, and PC. The first cluster is formed by all these four   gaming giants. The second cluster is mostly comprised of Xbox, Nintendo and Playstation, while PC and Playstation dominate the third cluster. 

## Models for global sales
To manage the complexity of publisher and developer data, and to sidestep collinearity, we've streamlined the number of publisher levels to 12, relegating the rest to "Others." We rely on critic scores over user scores, given their stronger correlation, and utilize the log value of user score count for its better relationship with global sales. Other sales log variables are omitted to avoid redundancy.

Here's how we prepare our data:
```{r}
# Re-categorize publishers into 13 groups
Publisher. <- head(names(sort(table(game$Publisher), decreasing = TRUE)), 12)

game <- game %>%
  mutate(Publisher.type = ifelse(Publisher %in% Publisher., as.character(Publisher), "Others")) 
game.lm <- game[, c(3:4, 11, 21, 23:26)] # Select relevant columns for linear model
```

Now, let's build a linear model to understand the factors affecting global sales:
```{r}
model <- lm(Global.Sales.Log ~ ., data = game.lm)
summary(model)
model <- aov(Global.Sales.Log ~ ., data = game.lm)
summary(model)
```

The log value of global sales is mostly influenced by factors of critic score, user count log, platform type, Publisher type, and genre in the linear model analysis. ANOVA shows every factor is a key player of significant contributor. Critic.Score and User.Count.Log are the lead actors in this statistical drama. They positively affect the global sales log, while other factors like Platform type and Genre either lift up or pull down the global sales according to their types. This model boasts an explanatory power with an R-Square of 0.57.

Given the nonlinear relationship indicated by our previous scatter plot about global sales versus critic scores (Figure \@ref(fig:game-SalesScore)) and the pronounced impact of critic scores in the linear model analysis, a polynomial model is entertained. 

```{r}
model <- lm(Global.Sales.Log ~ 
           Critic.Score + I(Critic.Score^2) + I(Critic.Score^3) + I(Critic.Score^4), 
           data = game.lm)
summary(model)
```

We focus on the third and fourth degrees of the polynomial fit as the initial levels lacked statistical significance in our pre-analysis.
```{r }
model <- lm(Global.Sales.Log ~ I(Critic.Score^3) + I(Critic.Score^4),  data = game.lm)
summary(model)
```

The coefficients are statistically significant — the simplified model with critic score to the third and fourth-degree terms, brings the drama with an R-squared of 0.16. Not quite a blockbuster hit, but certainly a critical darling.

To illustrate our findings:
```{r}
ModelFunc <- function(x) {model$coefficients[1] + x^3*model$coefficients[2] +
                          x^4*model$coefficients[3]}
ggplot(data = game.lm, aes(x = Critic.Score, y = Global.Sales.Log)) + 
  geom_point() + 
  stat_function(fun = ModelFunc, color = 'blue', size = 1)
```

Here is the scatter plot of Global.Sales.Log versus Critic Score, along with the predictive curve based on the polynomial model, which forecasts the global sales log using critic score.

>
```{exercise}

>
Visualize the distribution of NA_Sales in relation to Year_of_Release, Genre, Rating, and Platform using different plots, individually or combinedly. Interpret the relationship between NA_Sales with these factors. Hint: Consider applying log transformation to NA_Sales for better interpretability and potentially regroup platforms for a more consolidated view.
```

>
```{exercise}

>
What is the correlation between NA_Sales and Critic_Score? Use scatter plot with smooth trend line or a fitted polynomial curve to show the relationship. Give me your findings.
```

>
```{exercise}

>
Utilize linear modeling and ANOVA to analyze the contributing factors to the variance in NA_Sales. Provide a succinct interpretation of the results. Hint: Keep in mind the correlation patterns among those sales and scores highlighted in Figure \@ref(fig:game-corrplot).
```


##  Conclusion
While raw global and regional sales figures deviate from normality, their logarithmic counterparts dance closely with it. Patterns in regional sales harmonize with the global chorus.

Critic scores and user scores exhibit a sweet correlation, although the former typically trails the latter across most game titles. However, no clear-cut connection emerges between scores and the number of reviews.

Together, critic score, log-transformed user score count, genre, rating, platform, and publisher play their parts in the grand drama of log-transformation of global sales, with critic scores taking the star role, and the others in the supporting cast. Curtain call!